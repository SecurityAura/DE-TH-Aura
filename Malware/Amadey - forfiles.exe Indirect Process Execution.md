# *Amadey - forfiles.exe Indirect Process Execution*

## Query Information

Observed in October 2024, Amadey using forfiles.exe to call PowerShell.exe.

#### MITRE ATT&CK Technique(s)

| Technique ID | Title    | Link    |
| ---  | --- | --- |
| T1202 | Indirect Command Execution | https://attack.mitre.org/techniques/T1202/ |

#### Description

This rule detects the use of forfiles.exe to spawn a PowerShell.exe command by Amadey.

#### Risk

A user just executed an Amadey payload (e.g.: .pdf.lnk file)

#### Author <Optional>
- **Name:** SecurityAura
- **Github:** https://github.com/SecurityAura
- **Twitter:** https://x.com/SecurityAura
- **LinkedIn:** Coming Soon!
- **Website:** https://medium.com/@securityaura

#### References
- https://x.com/s1dhy/status/1847055133756072279

## Defender XDR
```KQL
DeviceProcessEvents
| where InitiatingProcessFileName =~ "forfiles.exe"
| where FileName =~ "powershell.exe"
```
## Microsoft Sentinel
```KQL
DeviceProcessEvents
| where InitiatingProcessFileName =~ "forfiles.exe"
| where FileName =~ "powershell.exe"
```
